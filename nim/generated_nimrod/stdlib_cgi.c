/* Generated by Nimrod Compiler v0.9.5 */
/*   (c) 2014 Andreas Rumpf */
/* The generated code is subject to the original license. */
#define NIM_INTBITS 64
#include "nimbase.h"

#include <string.h>
typedef struct tstringtable122812 tstringtable122812;
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct TNimObject TNimObject;
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct tkeyvaluepairseq122810 tkeyvaluepairseq122810;
typedef struct TY95944 TY95944;
struct  TGenericSeq  {
NI len;
NI reserved;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
typedef N_NIMCALL_PTR(void, TY2689) (void* p, NI op);
struct  TNimType  {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
TY2689 marker;
};
struct  TNimObject  {
TNimType* m_type;
};
struct TY95944 {
NimStringDesc* Field0;
NimStringDesc* Field1;
};
struct  tstringtable122812  {
  TNimObject Sup;
NI Counter;
tkeyvaluepairseq122810* Data;
NU8 Mode;
};
struct  TNimNode  {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct tkeyvaluepairseq122810 {
  TGenericSeq Sup;
  TY95944 data[SEQ_DECL_SIZE];
};
N_NIMCALL(NimStringDesc*, rawNewString)(NI space);
N_NIMCALL(NimStringDesc*, rawNewString)(NI cap);
static N_INLINE(void, addxmlchar_187262)(NimStringDesc** dest, NIM_CHAR c);
static N_INLINE(void, appendString)(NimStringDesc* dest, NimStringDesc* src);
N_NIMCALL(NimStringDesc*, resizeString)(NimStringDesc* dest, NI addlen);
N_NIMCALL(NimStringDesc*, addChar)(NimStringDesc* s, NIM_CHAR c);
STRING_LITERAL(TMP765, "&amp;", 5);
STRING_LITERAL(TMP766, "&lt;", 4);
STRING_LITERAL(TMP767, "&gt;", 4);
STRING_LITERAL(TMP768, "&quot;", 6);
tstringtable122812* gcookies_188077;

static N_INLINE(void, appendString)(NimStringDesc* dest, NimStringDesc* src) {
	memcpy(((NCSTRING) (&(*dest).data[((*dest).Sup.len)- 0])), ((NCSTRING) ((*src).data)), (NI64)((*src).Sup.len + 1));
	(*dest).Sup.len += (*src).Sup.len;
}

static N_INLINE(void, addxmlchar_187262)(NimStringDesc** dest, NIM_CHAR c) {
	switch (((NU8)(c))) {
	case 38:
	{
		(*dest) = resizeString((*dest), 5);
appendString((*dest), ((NimStringDesc*) &TMP765));
	}
	break;
	case 60:
	{
		(*dest) = resizeString((*dest), 4);
appendString((*dest), ((NimStringDesc*) &TMP766));
	}
	break;
	case 62:
	{
		(*dest) = resizeString((*dest), 4);
appendString((*dest), ((NimStringDesc*) &TMP767));
	}
	break;
	case 34:
	{
		(*dest) = resizeString((*dest), 6);
appendString((*dest), ((NimStringDesc*) &TMP768));
	}
	break;
	default:
	{
		(*dest) = addChar((*dest), c);
	}
	break;
	}
}

N_NIMCALL(NimStringDesc*, xmlencode_187273)(NimStringDesc* s) {
	NimStringDesc* result;
	NI i_187287;
	NI HEX3Atmp_187289;
	NI res_187291;
	result = 0;
	result = rawNewString((NI64)(s->Sup.len + (NI)((NU64)(s->Sup.len) >> (NU64)(2))));
	i_187287 = 0;
	HEX3Atmp_187289 = 0;
	HEX3Atmp_187289 = (NI64)(s->Sup.len - 1);
	res_187291 = 0;
	while (1) {
		if (!(res_187291 <= HEX3Atmp_187289)) goto LA1;
		i_187287 = res_187291;
		addxmlchar_187262(&result, s->data[i_187287]);
		res_187291 += 1;
	} LA1: ;
	return result;
}
N_NOINLINE(void, stdlib_cgiInit)(void) {
}

N_NOINLINE(void, stdlib_cgiDatInit)(void) {
}


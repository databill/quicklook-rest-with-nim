/* Generated by Nimrod Compiler v0.9.6 */
/*   (c) 2014 Andreas Rumpf */
/* The generated code is subject to the original license. */
#define NIM_INTBITS 64
#include "nimbase.h"

#include <string.h>
typedef struct ttable185052 ttable185052;
typedef struct tkeyvaluepairseq185055 tkeyvaluepairseq185055;
typedef struct tkeyvaluepair185058 tkeyvaluepair185058;
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct tcell44135 tcell44135;
typedef struct tcellseq44151 tcellseq44151;
typedef struct tgcheap46216 tgcheap46216;
typedef struct tcellset44147 tcellset44147;
typedef struct tpagedesc44143 tpagedesc44143;
typedef struct tmemregion26410 tmemregion26410;
typedef struct tsmallchunk25640 tsmallchunk25640;
typedef struct tllchunk26404 tllchunk26404;
typedef struct tbigchunk25642 tbigchunk25642;
typedef struct tintset25617 tintset25617;
typedef struct ttrunk25613 ttrunk25613;
typedef struct tavlnode26408 tavlnode26408;
typedef struct tgcstat46214 tgcstat46214;
typedef struct tbasechunk25638 tbasechunk25638;
typedef struct tfreecell25630 tfreecell25630;
struct  TGenericSeq  {
NI len;
NI reserved;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
struct tkeyvaluepair185058 {
NU8 Field0;
NimStringDesc* Field1;
NI Field2;
};
struct  ttable185052  {
tkeyvaluepairseq185055* Data;
NI Counter;
};
typedef N_NIMCALL_PTR(void, TY2689) (void* p, NI op);
typedef N_NIMCALL_PTR(void*, TY2694) (void* p);
struct  TNimType  {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
TY2689 marker;
TY2694 deepcopy;
};
struct  TNimNode  {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct  tcell44135  {
NI Refcount;
TNimType* Typ;
};
struct  tcellseq44151  {
NI Len;
NI Cap;
tcell44135** D;
};
struct  tcellset44147  {
NI Counter;
NI Max;
tpagedesc44143* Head;
tpagedesc44143** Data;
};
typedef tsmallchunk25640* TY26422[512];
typedef ttrunk25613* ttrunkbuckets25615[256];
struct  tintset25617  {
ttrunkbuckets25615 Data;
};
struct  tmemregion26410  {
NI Minlargeobj;
NI Maxlargeobj;
TY26422 Freesmallchunks;
tllchunk26404* Llmem;
NI Currmem;
NI Maxmem;
NI Freemem;
NI Lastsize;
tbigchunk25642* Freechunkslist;
tintset25617 Chunkstarts;
tavlnode26408* Root;
tavlnode26408* Deleted;
tavlnode26408* Last;
tavlnode26408* Freeavlnodes;
};
struct  tgcstat46214  {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
NI64 Maxpause;
};
struct  tgcheap46216  {
void* Stackbottom;
NI Cyclethreshold;
tcellseq44151 Zct;
tcellseq44151 Decstack;
tcellset44147 Cycleroots;
tcellseq44151 Tempstack;
NI Recgclock;
tmemregion26410 Region;
tgcstat46214 Stat;
};
typedef NI TY25620[8];
struct  tpagedesc44143  {
tpagedesc44143* Next;
NI Key;
TY25620 Bits;
};
struct  tbasechunk25638  {
NI Prevsize;
NI Size;
NIM_BOOL Used;
};
struct  tsmallchunk25640  {
  tbasechunk25638 Sup;
tsmallchunk25640* Next;
tsmallchunk25640* Prev;
tfreecell25630* Freelist;
NI Free;
NI Acc;
NF Data;
};
struct  tllchunk26404  {
NI Size;
NI Acc;
tllchunk26404* Next;
};
struct  tbigchunk25642  {
  tbasechunk25638 Sup;
tbigchunk25642* Next;
tbigchunk25642* Prev;
NI Align;
NF Data;
};
struct  ttrunk25613  {
ttrunk25613* Next;
NI Key;
TY25620 Bits;
};
typedef tavlnode26408* TY26414[2];
struct  tavlnode26408  {
TY26414 Link;
NI Key;
NI Upperbound;
NI Level;
};
struct  tfreecell25630  {
tfreecell25630* Next;
NI Zerofield;
};
struct tkeyvaluepairseq185055 {
  TGenericSeq Sup;
  tkeyvaluepair185058 data[SEQ_DECL_SIZE];
};
N_NIMCALL(void, nimGCvisit)(void* d, NI op);
N_NIMCALL(void, TMP162)(void* p, NI op);
N_NIMCALL(void*, newSeq)(TNimType* typ, NI len);
N_NIMCALL(void, unsureAsgnRef)(void** dest, void* src);
N_NIMCALL(NI, rawget_186094)(ttable185052 t_186101, NimStringDesc* key_186104);
N_NIMCALL(NI, hash_125842)(NimStringDesc* x);
static N_INLINE(NIM_BOOL, eqStrings)(NimStringDesc* a, NimStringDesc* b);
static N_INLINE(NI, nexttry_177609)(NI h, NI maxhash);
static N_INLINE(NIM_BOOL, mustrehash_177428)(NI length, NI counter);
N_NIMCALL(void, enlarge_186219)(ttable185052* t_186228);
N_NIMCALL(void, rawinsert_186289)(ttable185052* t_186298, tkeyvaluepairseq185055** data_186306, NimStringDesc* key_186310, NI val_186312);
N_NIMCALL(NimStringDesc*, copyStringRC1)(NimStringDesc* src);
static N_INLINE(void, nimGCunrefNoCycle)(void* p);
static N_INLINE(tcell44135*, usrtocell_47846)(void* usr);
static N_INLINE(void, rtladdzct_49404)(tcell44135* c);
N_NOINLINE(void, addzct_47817)(tcellseq44151* s, tcell44135* c);
TNimType NTI185052; /* TTable */
TNimType NTI185058; /* TKeyValuePair */
TNimType NTI177009; /* TSlotEnum */
extern TNimType NTI161; /* string */
extern TNimType NTI116; /* int */
TNimType NTI185055; /* TKeyValuePairSeq */
extern tgcheap46216 gch_46244;
N_NIMCALL(void, TMP162)(void* p, NI op) {
	tkeyvaluepairseq185055* a;
	NI LOC1;
	a = (tkeyvaluepairseq185055*)p;
	LOC1 = 0;
	for (LOC1 = 0; LOC1 < a->Sup.len; LOC1++) {
	nimGCvisit((void*)a->data[LOC1].Field1, op);
	}
}

N_NIMCALL(void, inittable_185230)(NI initialsize_185235, ttable185052* Result) {
	(*Result).Counter = 0;
	unsureAsgnRef((void**) &(*Result).Data, (tkeyvaluepairseq185055*) newSeq((&NTI185055), initialsize_185235));
}

static N_INLINE(NIM_BOOL, eqStrings)(NimStringDesc* a, NimStringDesc* b) {
	NIM_BOOL result;
	NIM_BOOL LOC11;
	int LOC13;
	result = 0;
	{
		if (!(a == b)) goto LA3;
		result = NIM_TRUE;
		goto BeforeRet;
	}
	LA3: ;
	{
		NIM_BOOL LOC7;
		LOC7 = 0;
		LOC7 = (a == NIM_NIL);
		if (LOC7) goto LA8;
		LOC7 = (b == NIM_NIL);
		LA8: ;
		if (!LOC7) goto LA9;
		result = NIM_FALSE;
		goto BeforeRet;
	}
	LA9: ;
	LOC11 = 0;
	LOC11 = ((*a).Sup.len == (*b).Sup.len);
	if (!(LOC11)) goto LA12;
	LOC13 = 0;
	LOC13 = memcmp(((NCSTRING) ((*a).data)), ((NCSTRING) ((*b).data)), (NI64)((*a).Sup.len * 1));
	LOC11 = (LOC13 == ((NI32) 0));
	LA12: ;
	result = LOC11;
	goto BeforeRet;
	BeforeRet: ;
	return result;
}

static N_INLINE(NI, nexttry_177609)(NI h, NI maxhash) {
	NI result;
	result = 0;
	result = (NI)((NI64)((NI64)(5 * h) + 1) & maxhash);
	return result;
}

N_NIMCALL(NI, rawget_186094)(ttable185052 t_186101, NimStringDesc* key_186104) {
	NI result;
	NI h;
	NI LOC1;
	result = 0;
	LOC1 = 0;
	LOC1 = hash_125842(key_186104);
	h = (NI)(LOC1 & (t_186101.Data->Sup.len-1));
	{
		while (1) {
			if (!!((t_186101.Data->data[h].Field0 == ((NU8) 0)))) goto LA3;
			{
				NIM_BOOL LOC6;
				LOC6 = 0;
				LOC6 = eqStrings(t_186101.Data->data[h].Field1, key_186104);
				if (!(LOC6)) goto LA7;
				LOC6 = (t_186101.Data->data[h].Field0 == ((NU8) 1));
				LA7: ;
				if (!LOC6) goto LA8;
				result = h;
				goto BeforeRet;
			}
			LA8: ;
			h = nexttry_177609(h, (t_186101.Data->Sup.len-1));
		} LA3: ;
	}
	result = -1;
	BeforeRet: ;
	return result;
}

N_NIMCALL(NIM_BOOL, haskey_186080)(ttable185052 t_186087, NimStringDesc* key_186090) {
	NIM_BOOL result;
	NI LOC1;
	result = 0;
	LOC1 = 0;
	LOC1 = rawget_186094(t_186087, key_186090);
	result = (0 <= LOC1);
	return result;
}

static N_INLINE(NIM_BOOL, mustrehash_177428)(NI length, NI counter) {
	NIM_BOOL result;
	NIM_BOOL LOC1;
	result = 0;
	LOC1 = 0;
	LOC1 = ((NI64)(length * 2) < (NI64)(counter * 3));
	if (LOC1) goto LA2;
	LOC1 = ((NI64)(length - counter) < 4);
	LA2: ;
	result = LOC1;
	return result;
}

static N_INLINE(tcell44135*, usrtocell_47846)(void* usr) {
	tcell44135* result;
	result = 0;
	result = ((tcell44135*) ((NI)((NU64)(((NI) (usr))) - (NU64)(((NI)sizeof(tcell44135))))));
	return result;
}

static N_INLINE(void, rtladdzct_49404)(tcell44135* c) {
	addzct_47817(&gch_46244.Zct, c);
}

static N_INLINE(void, nimGCunrefNoCycle)(void* p) {
	tcell44135* c;
	c = usrtocell_47846(p);
	{
		(*c).Refcount -= 8;
		if (!((NU64)((*c).Refcount) < (NU64)(8))) goto LA3;
		rtladdzct_49404(c);
	}
	LA3: ;
}

N_NIMCALL(void, rawinsert_186289)(ttable185052* t_186298, tkeyvaluepairseq185055** data_186306, NimStringDesc* key_186310, NI val_186312) {
	NI h;
	NI LOC1;
	NimStringDesc* LOC4;
	LOC1 = 0;
	LOC1 = hash_125842(key_186310);
	h = (NI)(LOC1 & ((*data_186306)->Sup.len-1));
	{
		while (1) {
			if (!((*data_186306)->data[h].Field0 == ((NU8) 1))) goto LA3;
			h = nexttry_177609(h, ((*data_186306)->Sup.len-1));
		} LA3: ;
	}
	LOC4 = 0;
	LOC4 = (*data_186306)->data[h].Field1; (*data_186306)->data[h].Field1 = copyStringRC1(key_186310);
	if (LOC4) nimGCunrefNoCycle(LOC4);
	(*data_186306)->data[h].Field2 = val_186312;
	(*data_186306)->data[h].Field0 = ((NU8) 1);
}

N_NIMCALL(void, enlarge_186219)(ttable185052* t_186228) {
	tkeyvaluepairseq185055* n;
	tkeyvaluepairseq185055* LOC8;
	n = 0;
	n = (tkeyvaluepairseq185055*) newSeq((&NTI185055), (NI64)((*t_186228).Data->Sup.len * 2));
	{
		NI i_186274;
		NI HEX3Atmp_186353;
		NI res_186356;
		i_186274 = 0;
		HEX3Atmp_186353 = 0;
		HEX3Atmp_186353 = ((*t_186228).Data->Sup.len-1);
		res_186356 = 0;
		{
			while (1) {
				if (!(res_186356 <= HEX3Atmp_186353)) goto LA3;
				i_186274 = res_186356;
				{
					if (!((*t_186228).Data->data[i_186274].Field0 == ((NU8) 1))) goto LA6;
					rawinsert_186289(t_186228, &n, (*t_186228).Data->data[i_186274].Field1, (*t_186228).Data->data[i_186274].Field2);
				}
				LA6: ;
				res_186356 += 1;
			} LA3: ;
		}
	}
	LOC8 = 0;
	LOC8 = (*t_186228).Data;
	unsureAsgnRef((void**) &(*t_186228).Data, n);
	n = LOC8;
}

N_NIMCALL(void, HEX5BHEX5DHEX3D_186174)(ttable185052* t_186183, NimStringDesc* key_186187, NI val_186189) {
	NI index;
	index = rawget_186094((*t_186183), key_186187);
	{
		if (!(0 <= index)) goto LA3;
		(*t_186183).Data->data[index].Field2 = val_186189;
	}
	goto LA1;
	LA3: ;
	{
		{
			NIM_BOOL LOC8;
			LOC8 = 0;
			LOC8 = mustrehash_177428((*t_186183).Data->Sup.len, (*t_186183).Counter);
			if (!LOC8) goto LA9;
			enlarge_186219(t_186183);
		}
		LA9: ;
		rawinsert_186289(t_186183, &(*t_186183).Data, key_186187, val_186189);
		(*t_186183).Counter += 1;
	}
	LA1: ;
}

N_NIMCALL(NI, HEX5BHEX5D_186143)(ttable185052 t_186150, NimStringDesc* key_186153) {
	NI result;
	NI index;
	result = 0;
	index = rawget_186094(t_186150, key_186153);
	{
		if (!(0 <= index)) goto LA3;
		result = t_186150.Data->data[index].Field2;
	}
	LA3: ;
	return result;
}
N_NOINLINE(void, HEX00_tablesInit)(void) {
}

N_NOINLINE(void, HEX00_tablesDatInit)(void) {
static TNimNode* TMP157[2];
static TNimNode* TMP158[3];
static TNimNode* TMP159[3];
NI TMP161;
static char* NIM_CONST TMP160[3] = {
"seEmpty", 
"seFilled", 
"seDeleted"};
static TNimNode TMP78[11];
NTI185052.size = sizeof(ttable185052);
NTI185052.kind = 18;
NTI185052.base = 0;
NTI185052.flags = 2;
TMP157[0] = &TMP78[1];
NTI185058.size = sizeof(tkeyvaluepair185058);
NTI185058.kind = 18;
NTI185058.base = 0;
NTI185058.flags = 2;
TMP158[0] = &TMP78[3];
NTI177009.size = sizeof(NU8);
NTI177009.kind = 14;
NTI177009.base = 0;
NTI177009.flags = 3;
for (TMP161 = 0; TMP161 < 3; TMP161++) {
TMP78[TMP161+4].kind = 1;
TMP78[TMP161+4].offset = TMP161;
TMP78[TMP161+4].name = TMP160[TMP161];
TMP159[TMP161] = &TMP78[TMP161+4];
}
TMP78[7].len = 3; TMP78[7].kind = 2; TMP78[7].sons = &TMP159[0];
NTI177009.node = &TMP78[7];
TMP78[3].kind = 1;
TMP78[3].offset = offsetof(tkeyvaluepair185058, Field0);
TMP78[3].typ = (&NTI177009);
TMP78[3].name = "Field0";
TMP158[1] = &TMP78[8];
TMP78[8].kind = 1;
TMP78[8].offset = offsetof(tkeyvaluepair185058, Field1);
TMP78[8].typ = (&NTI161);
TMP78[8].name = "Field1";
TMP158[2] = &TMP78[9];
TMP78[9].kind = 1;
TMP78[9].offset = offsetof(tkeyvaluepair185058, Field2);
TMP78[9].typ = (&NTI116);
TMP78[9].name = "Field2";
TMP78[2].len = 3; TMP78[2].kind = 2; TMP78[2].sons = &TMP158[0];
NTI185058.node = &TMP78[2];
NTI185055.size = sizeof(tkeyvaluepairseq185055*);
NTI185055.kind = 24;
NTI185055.base = (&NTI185058);
NTI185055.flags = 2;
NTI185055.marker = TMP162;
TMP78[1].kind = 1;
TMP78[1].offset = offsetof(ttable185052, Data);
TMP78[1].typ = (&NTI185055);
TMP78[1].name = "data";
TMP157[1] = &TMP78[10];
TMP78[10].kind = 1;
TMP78[10].offset = offsetof(ttable185052, Counter);
TMP78[10].typ = (&NTI116);
TMP78[10].name = "counter";
TMP78[0].len = 2; TMP78[0].kind = 2; TMP78[0].sons = &TMP157[0];
NTI185052.node = &TMP78[0];
}


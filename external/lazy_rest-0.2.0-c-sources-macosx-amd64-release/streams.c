/* Generated by Nimrod Compiler v0.9.6 */
/*   (c) 2014 Andreas Rumpf */
/* The generated code is subject to the original license. */
#define NIM_INTBITS 64
#include "nimbase.h"

#include <string.h>
typedef struct tstringstream130382 tstringstream130382;
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct tstream129835 tstream129835;
typedef struct TNimObject TNimObject;
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct tcell44135 tcell44135;
typedef struct tcellseq44151 tcellseq44151;
typedef struct tgcheap46216 tgcheap46216;
typedef struct tcellset44147 tcellset44147;
typedef struct tpagedesc44143 tpagedesc44143;
typedef struct tmemregion26410 tmemregion26410;
typedef struct tsmallchunk25640 tsmallchunk25640;
typedef struct tllchunk26404 tllchunk26404;
typedef struct tbigchunk25642 tbigchunk25642;
typedef struct tintset25617 tintset25617;
typedef struct ttrunk25613 ttrunk25613;
typedef struct tavlnode26408 tavlnode26408;
typedef struct tgcstat46214 tgcstat46214;
typedef struct tbasechunk25638 tbasechunk25638;
typedef struct tfreecell25630 tfreecell25630;
struct  TGenericSeq  {
NI len;
NI reserved;
};
struct  NimStringDesc  {
  TGenericSeq Sup;
NIM_CHAR data[SEQ_DECL_SIZE];
};
typedef N_NIMCALL_PTR(void, TY2689) (void* p, NI op);
typedef N_NIMCALL_PTR(void*, TY2694) (void* p);
struct  TNimType  {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
TY2689 marker;
TY2694 deepcopy;
};
struct  TNimObject  {
TNimType* m_type;
};
typedef N_NIMCALL_PTR(void, TY129836) (tstream129835* s);
typedef N_NIMCALL_PTR(NIM_BOOL, TY129840) (tstream129835* s);
typedef N_NIMCALL_PTR(void, TY129844) (tstream129835* s, NI pos);
typedef N_NIMCALL_PTR(NI, TY129849) (tstream129835* s);
typedef N_NIMCALL_PTR(NI, TY129853) (tstream129835* s, void* buffer, NI buflen);
typedef N_NIMCALL_PTR(void, TY129859) (tstream129835* s, void* buffer, NI buflen);
typedef N_NIMCALL_PTR(void, TY129865) (tstream129835* s);
struct  tstream129835  {
  TNimObject Sup;
TY129836 Closeimpl;
TY129840 Atendimpl;
TY129844 Setpositionimpl;
TY129849 Getpositionimpl;
TY129853 Readdataimpl;
TY129859 Writedataimpl;
TY129865 Flushimpl;
};
struct  tstringstream130382  {
  tstream129835 Sup;
NimStringDesc* Data;
NI Pos;
};
struct  TNimNode  {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct  tcell44135  {
NI Refcount;
TNimType* Typ;
};
struct  tcellseq44151  {
NI Len;
NI Cap;
tcell44135** D;
};
struct  tcellset44147  {
NI Counter;
NI Max;
tpagedesc44143* Head;
tpagedesc44143** Data;
};
typedef tsmallchunk25640* TY26422[512];
typedef ttrunk25613* ttrunkbuckets25615[256];
struct  tintset25617  {
ttrunkbuckets25615 Data;
};
struct  tmemregion26410  {
NI Minlargeobj;
NI Maxlargeobj;
TY26422 Freesmallchunks;
tllchunk26404* Llmem;
NI Currmem;
NI Maxmem;
NI Freemem;
NI Lastsize;
tbigchunk25642* Freechunkslist;
tintset25617 Chunkstarts;
tavlnode26408* Root;
tavlnode26408* Deleted;
tavlnode26408* Last;
tavlnode26408* Freeavlnodes;
};
struct  tgcstat46214  {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
NI64 Maxpause;
};
struct  tgcheap46216  {
void* Stackbottom;
NI Cyclethreshold;
tcellseq44151 Zct;
tcellseq44151 Decstack;
tcellset44147 Cycleroots;
tcellseq44151 Tempstack;
NI Recgclock;
tmemregion26410 Region;
tgcstat46214 Stat;
};
typedef NI TY25620[8];
struct  tpagedesc44143  {
tpagedesc44143* Next;
NI Key;
TY25620 Bits;
};
struct  tbasechunk25638  {
NI Prevsize;
NI Size;
NIM_BOOL Used;
};
struct  tsmallchunk25640  {
  tbasechunk25638 Sup;
tsmallchunk25640* Next;
tsmallchunk25640* Prev;
tfreecell25630* Freelist;
NI Free;
NI Acc;
NF Data;
};
struct  tllchunk26404  {
NI Size;
NI Acc;
tllchunk26404* Next;
};
struct  tbigchunk25642  {
  tbasechunk25638 Sup;
tbigchunk25642* Next;
tbigchunk25642* Prev;
NI Align;
NF Data;
};
struct  ttrunk25613  {
ttrunk25613* Next;
NI Key;
TY25620 Bits;
};
typedef tavlnode26408* TY26414[2];
struct  tavlnode26408  {
TY26414 Link;
NI Key;
NI Upperbound;
NI Level;
};
struct  tfreecell25630  {
tfreecell25630* Next;
NI Zerofield;
};
N_NIMCALL(void, nimGCvisit)(void* d, NI op);
N_NIMCALL(void, TMP107)(void* p, NI op);
N_NIMCALL(void*, newObj)(TNimType* typ, NI size);
N_NIMCALL(NimStringDesc*, copyStringRC1)(NimStringDesc* src);
static N_INLINE(void, nimGCunrefNoCycle)(void* p);
static N_INLINE(tcell44135*, usrtocell_47846)(void* usr);
static N_INLINE(void, rtladdzct_49404)(tcell44135* c);
N_NOINLINE(void, addzct_47817)(tcellseq44151* s, tcell44135* c);
N_NIMCALL(void, ssclose_130493)(tstream129835* s_130495);
N_NIMCALL(NIM_BOOL, ssatend_130388)(tstream129835* s_130390);
N_NIMCALL(void, sssetposition_130399)(tstream129835* s_130401, NI pos);
N_NIMCALL(NI, clamp_130405)(NI x_130409, NI a_130411, NI b_130413);
N_NIMCALL(NI, ssgetposition_130426)(tstream129835* s_130428);
N_NIMCALL(NI, ssreaddata_130437)(tstream129835* s_130439, void* buffer, NI buflen);
N_NIMCALL(void, sswritedata_130467)(tstream129835* s_130469, void* buffer, NI buflen);
N_NIMCALL(NimStringDesc*, setLengthStr)(NimStringDesc* s, NI newlen);
N_NIMCALL(void, TMP119)(void* p, NI op);
extern TNimType NTI2811; /* TObject */
TNimType NTI129835; /* TStream */
TNimType NTI129836; /* proc (PStream){.gcsafe.} */
TNimType NTI129840; /* proc (PStream): bool{.gcsafe.} */
TNimType NTI129844; /* proc (PStream, int){.gcsafe.} */
TNimType NTI129849; /* proc (PStream): int{.gcsafe.} */
TNimType NTI129853; /* proc (PStream, pointer, int): int{.gcsafe.} */
TNimType NTI129859; /* proc (PStream, pointer, int){.gcsafe.} */
TNimType NTI129865; /* proc (PStream){.gcsafe.} */
TNimType NTI130382; /* TStringStream */
extern TNimType NTI161; /* string */
extern TNimType NTI116; /* int */
TNimType NTI130380; /* PStringStream */
extern tgcheap46216 gch_46244;
TNimType NTI129833; /* PStream */
N_NIMCALL(void, TMP107)(void* p, NI op) {
	tstringstream130382* a;
	a = (tstringstream130382*)p;
	nimGCvisit((void*)(*a).Data, op);
}

static N_INLINE(tcell44135*, usrtocell_47846)(void* usr) {
	tcell44135* result;
	result = 0;
	result = ((tcell44135*) ((NI)((NU64)(((NI) (usr))) - (NU64)(((NI)sizeof(tcell44135))))));
	return result;
}

static N_INLINE(void, rtladdzct_49404)(tcell44135* c) {
	addzct_47817(&gch_46244.Zct, c);
}

static N_INLINE(void, nimGCunrefNoCycle)(void* p) {
	tcell44135* c;
	c = usrtocell_47846(p);
	{
		(*c).Refcount -= 8;
		if (!((NU64)((*c).Refcount) < (NU64)(8))) goto LA3;
		rtladdzct_49404(c);
	}
	LA3: ;
}

N_NIMCALL(void, ssclose_130493)(tstream129835* s_130495) {
	tstringstream130382* s;
	NimStringDesc* LOC1;
	s = ((tstringstream130382*) (s_130495));
	LOC1 = 0;
	LOC1 = (*s).Data; (*s).Data = copyStringRC1(NIM_NIL);
	if (LOC1) nimGCunrefNoCycle(LOC1);
}

N_NIMCALL(NIM_BOOL, ssatend_130388)(tstream129835* s_130390) {
	NIM_BOOL result;
	tstringstream130382* s;
	result = 0;
	s = ((tstringstream130382*) (s_130390));
	result = ((*s).Data->Sup.len <= (*s).Pos);
	goto BeforeRet;
	BeforeRet: ;
	return result;
}

N_NIMCALL(void, sssetposition_130399)(tstream129835* s_130401, NI pos) {
	tstringstream130382* s;
	s = ((tstringstream130382*) (s_130401));
	(*s).Pos = clamp_130405(pos, 0, ((*s).Data->Sup.len-1));
}

N_NIMCALL(NI, ssgetposition_130426)(tstream129835* s_130428) {
	NI result;
	tstringstream130382* s;
	result = 0;
	s = ((tstringstream130382*) (s_130428));
	result = (*s).Pos;
	goto BeforeRet;
	BeforeRet: ;
	return result;
}

N_NIMCALL(NI, ssreaddata_130437)(tstream129835* s_130439, void* buffer, NI buflen) {
	NI result;
	tstringstream130382* s;
	result = 0;
	s = ((tstringstream130382*) (s_130439));
	result = ((buflen <= (NI64)((*s).Data->Sup.len - (*s).Pos)) ? buflen : (NI64)((*s).Data->Sup.len - (*s).Pos));
	{
		if (!(0 < result)) goto LA3;
		memcpy(buffer, ((void*) (&(*s).Data->data[(*s).Pos])), result);
		(*s).Pos += result;
	}
	LA3: ;
	return result;
}

N_NIMCALL(void, sswritedata_130467)(tstream129835* s_130469, void* buffer, NI buflen) {
	tstringstream130382* s;
	s = ((tstringstream130382*) (s_130469));
	{
		if (!(0 < buflen)) goto LA3;
		(*s).Data = setLengthStr((*s).Data, (NI64)((*s).Data->Sup.len + buflen));
		memcpy(((void*) (&(*s).Data->data[(*s).Pos])), buffer, buflen);
		(*s).Pos += buflen;
	}
	LA3: ;
}

N_NIMCALL(tstringstream130382*, newstringstream_130503)(NimStringDesc* s) {
	tstringstream130382* result;
	NimStringDesc* LOC1;
	result = 0;
	result = (tstringstream130382*) newObj((&NTI130380), sizeof(tstringstream130382));
	(*result).Sup.Sup.m_type = (&NTI130382);
	LOC1 = 0;
	LOC1 = (*result).Data; (*result).Data = copyStringRC1(s);
	if (LOC1) nimGCunrefNoCycle(LOC1);
	(*result).Pos = 0;
	(*result).Sup.Closeimpl = ssclose_130493;
	(*result).Sup.Atendimpl = ssatend_130388;
	(*result).Sup.Setpositionimpl = sssetposition_130399;
	(*result).Sup.Getpositionimpl = ssgetposition_130426;
	(*result).Sup.Readdataimpl = ssreaddata_130437;
	(*result).Sup.Writedataimpl = sswritedata_130467;
	return result;
}
N_NIMCALL(void, TMP119)(void* p, NI op) {
	tstream129835* a;
	a = (tstream129835*)p;
}

N_NIMCALL(NI, readdata_129977)(tstream129835* s, void* buffer, NI buflen) {
	NI result;
	result = 0;
	result = (*s).Readdataimpl(s, buffer, buflen);
	return result;
}

N_NIMCALL(void, close_129888)(tstream129835* s) {
	{
		if (!!((*s).Closeimpl == 0)) goto LA3;
		(*s).Closeimpl(s);
	}
	LA3: ;
}
N_NOINLINE(void, HEX00_streamsInit)(void) {
}

N_NOINLINE(void, HEX00_streamsDatInit)(void) {
static TNimNode* TMP105[7];
static TNimNode* TMP106[2];
static TNimNode TMP31[11];
NTI129835.size = sizeof(tstream129835);
NTI129835.kind = 17;
NTI129835.base = (&NTI2811);
NTI129835.flags = 1;
TMP105[0] = &TMP31[1];
NTI129836.size = sizeof(TY129836);
NTI129836.kind = 25;
NTI129836.base = 0;
NTI129836.flags = 3;
TMP31[1].kind = 1;
TMP31[1].offset = offsetof(tstream129835, Closeimpl);
TMP31[1].typ = (&NTI129836);
TMP31[1].name = "closeImpl";
TMP105[1] = &TMP31[2];
NTI129840.size = sizeof(TY129840);
NTI129840.kind = 25;
NTI129840.base = 0;
NTI129840.flags = 3;
TMP31[2].kind = 1;
TMP31[2].offset = offsetof(tstream129835, Atendimpl);
TMP31[2].typ = (&NTI129840);
TMP31[2].name = "atEndImpl";
TMP105[2] = &TMP31[3];
NTI129844.size = sizeof(TY129844);
NTI129844.kind = 25;
NTI129844.base = 0;
NTI129844.flags = 3;
TMP31[3].kind = 1;
TMP31[3].offset = offsetof(tstream129835, Setpositionimpl);
TMP31[3].typ = (&NTI129844);
TMP31[3].name = "setPositionImpl";
TMP105[3] = &TMP31[4];
NTI129849.size = sizeof(TY129849);
NTI129849.kind = 25;
NTI129849.base = 0;
NTI129849.flags = 3;
TMP31[4].kind = 1;
TMP31[4].offset = offsetof(tstream129835, Getpositionimpl);
TMP31[4].typ = (&NTI129849);
TMP31[4].name = "getPositionImpl";
TMP105[4] = &TMP31[5];
NTI129853.size = sizeof(TY129853);
NTI129853.kind = 25;
NTI129853.base = 0;
NTI129853.flags = 3;
TMP31[5].kind = 1;
TMP31[5].offset = offsetof(tstream129835, Readdataimpl);
TMP31[5].typ = (&NTI129853);
TMP31[5].name = "readDataImpl";
TMP105[5] = &TMP31[6];
NTI129859.size = sizeof(TY129859);
NTI129859.kind = 25;
NTI129859.base = 0;
NTI129859.flags = 3;
TMP31[6].kind = 1;
TMP31[6].offset = offsetof(tstream129835, Writedataimpl);
TMP31[6].typ = (&NTI129859);
TMP31[6].name = "writeDataImpl";
TMP105[6] = &TMP31[7];
NTI129865.size = sizeof(TY129865);
NTI129865.kind = 25;
NTI129865.base = 0;
NTI129865.flags = 3;
TMP31[7].kind = 1;
TMP31[7].offset = offsetof(tstream129835, Flushimpl);
TMP31[7].typ = (&NTI129865);
TMP31[7].name = "flushImpl";
TMP31[0].len = 7; TMP31[0].kind = 2; TMP31[0].sons = &TMP105[0];
NTI129835.node = &TMP31[0];
NTI130382.size = sizeof(tstringstream130382);
NTI130382.kind = 17;
NTI130382.base = (&NTI129835);
TMP106[0] = &TMP31[9];
TMP31[9].kind = 1;
TMP31[9].offset = offsetof(tstringstream130382, Data);
TMP31[9].typ = (&NTI161);
TMP31[9].name = "data";
TMP106[1] = &TMP31[10];
TMP31[10].kind = 1;
TMP31[10].offset = offsetof(tstringstream130382, Pos);
TMP31[10].typ = (&NTI116);
TMP31[10].name = "pos";
TMP31[8].len = 2; TMP31[8].kind = 2; TMP31[8].sons = &TMP106[0];
NTI130382.node = &TMP31[8];
NTI130380.size = sizeof(tstringstream130382*);
NTI130380.kind = 22;
NTI130380.base = (&NTI130382);
NTI130380.marker = TMP107;
NTI129833.size = sizeof(tstream129835*);
NTI129833.kind = 22;
NTI129833.base = (&NTI129835);
NTI129833.marker = TMP119;
}

